<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PiCast SI4713 Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css">
  </head>
  <body>
    <div class="pure-g">
      <div class="pure-u-1">
        <h1>PiCast SI4713</h1>
        <p>Responsive FM + RDS control surface</p>
      </div>
    </div>

    <nav class="pure-menu pure-menu-horizontal" role="tablist" aria-label="Dashboard sections">
      <ul class="pure-menu-list">
        <li class="pure-menu-item pure-menu-selected" role="presentation">
          <a href="#overview" class="pure-menu-link" id="tab-button-overview" role="tab" aria-controls="tab-overview" aria-selected="true" data-tab-trigger data-tab="overview">Overview</a>
        </li>
        <li class="pure-menu-item" role="presentation">
          <a href="#rf" class="pure-menu-link" id="tab-button-rf" role="tab" aria-controls="tab-rf" aria-selected="false" data-tab-trigger data-tab="rf">RF</a>
        </li>
        <li class="pure-menu-item" role="presentation">
          <a href="#audio" class="pure-menu-link" id="tab-button-audio" role="tab" aria-controls="tab-audio" aria-selected="false" data-tab-trigger data-tab="audio">Audio</a>
        </li>
        <li class="pure-menu-item" role="presentation">
          <a href="#rds-ps" class="pure-menu-link" id="tab-button-rds-ps" role="tab" aria-controls="tab-rds-ps" aria-selected="false" data-tab-trigger data-tab="rds-ps">RDS PS</a>
        </li>
        <li class="pure-menu-item" role="presentation">
          <a href="#rds-rt" class="pure-menu-link" id="tab-button-rds-rt" role="tab" aria-controls="tab-rds-rt" aria-selected="false" data-tab-trigger data-tab="rds-rt">RDS RT</a>
        </li>
        <li class="pure-menu-item" role="presentation">
          <a href="#rds-rt-automation" class="pure-menu-link" id="tab-button-rds-rt-automation" role="tab" aria-controls="tab-rds-rt-automation" aria-selected="false" data-tab-trigger data-tab="rds-rt-automation">RDS RT Automation</a>
        </li>
      </ul>
    </nav>

    {% set di_flags = [
      ("di-stereo", "Stereo"),
      ("di-artificial-head", "Artificial Head"),
      ("di-compressed", "Compressed"),
      ("di-dynamic-pty", "Dynamic PTY")
    ] %}
    {% set rds_flag_switches = [
      ("rds-tp", "Traffic Programme (TP)"),
      ("rds-ta", "Traffic Announcement (TA)"),
      ("rds-ms-music", "Music Service")
    ] %}

    <form id="config-form" class="pure-form pure-form-stacked">
      <div class="pure-g">
        <div class="pure-u-1 pure-u-xl-3-4">
          <fieldset id="config-fields" disabled>
            <legend>Transmitter configuration</legend>

            <section class="tab-panel" data-tab-panel="overview" id="tab-overview" role="tabpanel" aria-labelledby="tab-button-overview">
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-2-3">
                  <fieldset>
                    <legend>Broadcast summary</legend>
                    <p>Broadcast status: <strong id="status-broadcast">OFF</strong></p>
                    <label class="pure-checkbox" for="toggle-broadcast">
                      <input type="checkbox" id="toggle-broadcast">
                      Enable broadcast
                    </label>
                    <p>Watchdog: <span id="metric-watchdog">—</span></p>
                    <p id="metric-overmod" hidden>Over modulation detected. Reduce input gain or deviation.</p>
                    <table class="pure-table pure-table-horizontal">
                      <tbody>
                        <tr>
                          <th scope="row">Program Service</th>
                          <td id="metric-ps">—</td>
                        </tr>
                        <tr>
                          <th scope="row">Radiotext</th>
                          <td id="metric-rt">—</td>
                        </tr>
                        <tr>
                          <th scope="row">Frequency</th>
                          <td id="metric-frequency">—</td>
                        </tr>
                        <tr>
                          <th scope="row">Power / Capacitance</th>
                          <td><span id="metric-power">—</span> dBµV · <span id="metric-cap">—</span></td>
                        </tr>
                        <tr>
                          <th scope="row">Audio Input</th>
                          <td><span id="metric-audio-level">—</span></td>
                        </tr>
                        <tr>
                          <th scope="row">Audio Status</th>
                          <td id="metric-audio-status">Limiter idle</td>
                        </tr>
                      </tbody>
                    </table>
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-3">
                  <fieldset>
                    <legend>RDS snapshot</legend>
                    <table class="pure-table pure-table-horizontal">
                      <tbody>
                        <tr>
                          <th scope="row">PI Code</th>
                          <td id="metric-rds-pi">—</td>
                        </tr>
                        <tr>
                          <th scope="row">PTY</th>
                          <td id="metric-rds-pty">—</td>
                        </tr>
                        <tr>
                          <th scope="row">Flags</th>
                          <td id="metric-rds-flags">RDS Inactive</td>
                        </tr>
                        <tr>
                          <th scope="row">Program Service rotation</th>
                          <td>
                            <div id="metric-rds-ps">—</div>
                            <div id="metric-rds-ps-meta" hidden></div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </fieldset>
                </div>
              </div>
            </section>

            <section class="tab-panel" data-tab-panel="rf" id="tab-rf" role="tabpanel" aria-labelledby="tab-button-rf" hidden>
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset>
                    <legend>Carrier</legend>
                    <div class="pure-g">
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="rf-frequency">Frequency (MHz)</label>
                        <input type="number" id="rf-frequency" class="pure-input-1" min="76" max="108" step="0.1" inputmode="decimal">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="rf-power">Power (dBµV)</label>
                        <input type="number" id="rf-power" class="pure-input-1" min="88" max="120">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="rf-antenna">Antenna Capacitance</label>
                        <input type="number" id="rf-antenna" class="pure-input-1" min="0" max="255">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="monitor-interval">Telemetry Interval (s)</label>
                        <input type="number" id="monitor-interval" class="pure-input-1" min="0.1" step="0.1">
                        <span>Preview: <span id="monitor-interval-readonly">—</span></span>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset>
                    <legend>Watchdog Monitoring</legend>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="monitor-health">
                      Hardware Health
                    </label>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="monitor-asq">
                      ASQ Monitoring
                    </label>
                  </fieldset>
                  <fieldset>
                    <legend>Recovery Strategy</legend>
                    <div class="pure-g">
                      <div class="pure-u-1 pure-u-md-1-3">
                        <label for="monitor-recovery-attempts">Recovery Attempts</label>
                        <input type="number" id="monitor-recovery-attempts" class="pure-input-1" min="0">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-3">
                        <label for="monitor-recovery-backoff">Backoff (s)</label>
                        <input type="number" id="monitor-recovery-backoff" class="pure-input-1" min="0" step="0.1">
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </section>

            <section class="tab-panel" data-tab-panel="audio" id="tab-audio" role="tabpanel" aria-labelledby="tab-button-audio" hidden>
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset>
                    <legend>Stereo and Pre-emphasis</legend>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="audio-stereo">
                      Stereo composite
                    </label>
                    <label for="audio-preemphasis">Pre-emphasis Curve</label>
                    <select id="audio-preemphasis" class="pure-input-1">
                      <option value="50">50 µs (Europe)</option>
                      <option value="75">75 µs (United States)</option>
                    </select>
                  </fieldset>
                  <fieldset>
                    <legend>Processing Presets</legend>
                    <label for="audio-preset">Preset</label>
                    <select id="audio-preset" class="pure-input-1">
                      <option value="">Select preset…</option>
                      <option value="broadcast">Broadcast reference (–16 dBFS)</option>
                      <option value="music">Music – Smooth</option>
                      <option value="voice">Speech – Articulate</option>
                    </select>
                    <button type="button" class="pure-button" id="audio-preset-reset" disabled>Reset to preset</button>
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset>
                    <legend>Dynamics &amp; Limiter</legend>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="audio-agc">
                      Automatic Gain Control (AGC)
                    </label>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="audio-limiter">
                      Limiter Enabled
                    </label>
                    <div class="pure-g">
                      <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
                        <label for="audio-comp-thr">Compressor Threshold (dB)</label>
                        <input type="number" id="audio-comp-thr" class="pure-input-1" min="-96" max="31">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
                        <label for="audio-comp-att">Attack (index)</label>
                        <input type="number" id="audio-comp-att" class="pure-input-1" min="0" max="63">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
                        <label for="audio-comp-rel">Release (index)</label>
                        <input type="number" id="audio-comp-rel" class="pure-input-1" min="0" max="63">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
                        <label for="audio-comp-gain">Gain (dB)</label>
                        <input type="number" id="audio-comp-gain" class="pure-input-1" min="0" max="63">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-3">
                        <label for="audio-lim-rel">Limiter Release (index)</label>
                        <input type="number" id="audio-lim-rel" class="pure-input-1" min="0" max="1023">
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </section>

            <section class="tab-panel" data-tab-panel="rds-ps" id="tab-rds-ps" role="tabpanel" aria-labelledby="tab-button-rds-ps" hidden>
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset>
                    <legend>RDS Carrier</legend>
                    <label class="pure-checkbox" for="rds-enabled">
                      <input type="checkbox" id="rds-enabled">
                      Enable RDS subcarrier
                    </label>
                  </fieldset>
                  <fieldset data-rds-section>
                    <legend>RDS Identity</legend>
                    <label for="rds-pi">PI Code</label>
                    <input type="text" id="rds-pi" class="pure-input-1" placeholder="1EE7" pattern="[0-9A-Fa-f]*" inputmode="text" maxlength="4" autocomplete="off">
                    <span>Enter a four-digit hexadecimal value.</span>
                    <label for="rds-pty">PTY</label>
                    <input type="number" id="rds-pty" class="pure-input-1" min="0" max="31">
                    {% for field_id, label in rds_flag_switches %}
                      <label class="pure-checkbox">
                        <input type="checkbox" id="{{ field_id }}">
                        {{ label }}
                      </label>
                    {% endfor %}
                    <p>Decoder Identification (DI)</p>
                    {% for field_id, label in di_flags %}
                      <label class="pure-checkbox">
                        <input type="checkbox" id="{{ field_id }}">
                        {{ label }}
                      </label>
                    {% endfor %}
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset data-rds-section>
                    <legend>Program Service Slots</legend>
                    <div class="pure-g">
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="rds-ps-count">Active Slots</label>
                        <input type="number" id="rds-ps-count" class="pure-input-1" min="1" max="8">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-2">
                        <label for="rds-ps-speed">Cycle Speed (s)</label>
                        <input type="number" id="rds-ps-speed" class="pure-input-1" min="1">
                      </div>
                    </div>
                    <label class="pure-checkbox">
                      <input type="checkbox" id="rds-ps-center">
                      Center text
                    </label>
                    <label for="ps-list">PS Slots</label>
                    <button type="button" class="pure-button" id="btn-add-ps">Add Slot</button>
                    <div id="ps-list"></div>
                  </fieldset>
                </div>
              </div>
            </section>

            <section class="tab-panel" data-tab-panel="rds-rt" id="tab-rds-rt" role="tabpanel" aria-labelledby="tab-button-rds-rt" hidden>
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset data-rds-section>
                    <legend>Radiotext Defaults</legend>
                    <label for="rt-text">Fallback Text</label>
                    <input type="text" id="rt-text" class="pure-input-1" maxlength="64">
                    <label for="rt-speed">Rotation Speed (s)</label>
                    <input type="number" id="rt-speed" class="pure-input-1" min="1" step="0.1">
                    <label class="pure-checkbox" for="rt-center">
                      <input type="checkbox" id="rt-center">
                      Center text
                    </label>
                    <label for="rt-ab-mode">A/B Mode</label>
                    <select id="rt-ab-mode" class="pure-input-1">
                      <option value="auto">Auto</option>
                      <option value="legacy">Legacy</option>
                      <option value="bank">Bank</option>
                    </select>
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset data-rds-section>
                    <legend>Rotation Entries</legend>
                    <label for="rt-texts-list">Rotation Entries</label>
                    <button type="button" class="pure-button" id="btn-add-rt-text">Add Entry</button>
                    <div id="rt-texts-list"></div>
                  </fieldset>
                </div>
              </div>
            </section>

            <section class="tab-panel" data-tab-panel="rds-rt-automation" id="tab-rds-rt-automation" role="tabpanel" aria-labelledby="tab-button-rds-rt-automation" hidden>
              <div class="pure-g">
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset data-rds-section>
                    <legend>Automation</legend>
                    <label for="rt-file-path">External Script File</label>
                    <input type="text" id="rt-file-path" class="pure-input-1" placeholder="/path/to/rt.txt">
                    <label for="rt-skip-words-list">Skip Words</label>
                    <button type="button" class="pure-button" id="btn-add-skip-word">Add Word</button>
                    <div id="rt-skip-words-list"></div>
                  </fieldset>
                </div>
                <div class="pure-u-1 pure-u-lg-1-2">
                  <fieldset data-rds-section>
                    <legend>Burst Settings</legend>
                    <div class="pure-g">
                      <div class="pure-u-1 pure-u-md-1-3">
                        <label for="rt-repeats">Burst Repeats</label>
                        <input type="number" id="rt-repeats" class="pure-input-1" min="1">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-3">
                        <label for="rt-gap">Burst Gap (ms)</label>
                        <input type="number" id="rt-gap" class="pure-input-1" min="0">
                      </div>
                      <div class="pure-u-1 pure-u-md-1-3">
                        <label for="rt-bank">Bank (0/1)</label>
                        <input type="number" id="rt-bank" class="pure-input-1" min="0" max="1">
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </section>
          </fieldset>
        </div>

        <div class="pure-u-1 pure-u-xl-1-4">
          <fieldset>
            <legend>Configuration Profiles</legend>
            <label for="config-select">Available Profiles</label>
            <select id="config-select" class="pure-input-1">
              <option value="">Select configuration…</option>
              {% for item in configs %}
                <option value="{{ item }}">{{ item }}</option>
              {% endfor %}
            </select>
            <button class="pure-button" id="btn-refresh" type="button">Refresh</button>
            <button class="pure-button" id="btn-duplicate" type="button" disabled>Duplicate</button>
            <button class="pure-button" id="btn-save" type="button" disabled>Save</button>
            <button class="pure-button pure-button-primary" id="btn-apply" type="button" disabled>Apply &amp; Activate</button>
          </fieldset>
        </div>
      </div>
    </form>

    <div id="config-feedback" role="alert" hidden></div>

    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
  </body>
</html>
